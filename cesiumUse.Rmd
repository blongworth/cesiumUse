---
title: "Cesium Use plots"
output:
  html_document:
    df_print: paged
---

Plot and predict Cesium use based on resevoir mass.

* TODO: add data for CFAMS
* TODO: calculate days since new Cs
* TODO: calculate res mass from initial mass
* TODO: calculate use per target


```{r}
library(tidyverse)
library(lubridate)
library(amstools)
```

```{r}
cs <- read.csv("cesium.csv") %>%
  mutate(Date = mdy(Date),
         No = as.factor(
           ifelse(Mass > 400, 1, 
                  ifelse(Date > ymd("2018-02-11"), 3, 
                         2))),
         CsMass = ifelse(Mass > 400, Mass - 406.8, Mass - 393.3),
         startdate = recode(No,
                            `1` = ymd("2016-07-14"), 
                            `2` = ymd("2017-03-10"),
                            `3` = ymd("2018-02-12")),
         et = Date - startdate)

         cs$runs = mapply(numRun, cs$startdate, cs$Date, "USAMS")[1,]
```

```{r}
cs.lm <- lm(CsMass ~ et, data = cs)
cs.lm
use <- abs(coef(cs.lm)["et"])
use5 <- 5 / use 
```

Average use rate is `r round(use, 2)` g per day. Thats `r round(use5)` days per charge.
```{r}
ggplot(cs, aes(et, CsMass, color = No)) +
  geom_smooth(method = "lm", fullrange = TRUE) +
  geom_point()  
ggplot(cs, aes(runs, CsMass, color = No)) +
  geom_smooth(method = "lm", fullrange = TRUE) +
  geom_point()  
```
```{r}

```

